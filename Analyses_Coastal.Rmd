---
title: "Coastal Analysis"
output: pdf_document
---

```{r,echo=FALSE,message=FALSE,warning=FALSE}
# Set so that long lines in R will be wrapped:
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70), tidy=TRUE)
```
## TLDR: To replicate tables in slides, run tab_model commands at the bottom (that is, after running all the models)

## Read in data
```{r}
library(readxl)
library(gee)
library(sjPlot)
library(sjmisc)
library(sjlabelled)

#Read in dataset with coastal coding. Read in summary sheet (sheet 13)
coastal <- read_excel("FIPS-based datasets_05232021.xlsx", sheet = 13)

#summary(coastal)

#Read in PM25 and humidity data from our 2020 study, created with: confounding = data.frame(fips = aggregate_pm_census_cdc_test_beds$fips, median_house_value = aggregate_pm_census_cdc_test_beds$median_house_value, owner_occupied = aggregate_pm_census_cdc_test_beds$owner_occupied, blk_pct = aggregate_pm_census_cdc_test_beds$blk_pct, hispanic_pct = aggregate_pm_census_cdc_test_beds$hispanic_pct, white_pct = aggregate_pm_census_cdc_test_beds$white_pct, native_pct = aggregate_pm_census_cdc_test_beds$native_pct, asian_pct = aggregate_pm_census_cdc_test_beds$asian_pct, no_grad = aggregate_pm_census_cdc_test_beds$no_grad, date_since_social =  aggregate_pm_census_cdc_test_beds$date_since_social, date_since = aggregate_pm_census_cdc_test_beds$date_since, beds = aggregate_pm_census_cdc_test_beds$beds, population.old = aggregate_pm_census_cdc_test_beds$population, smoke = aggregate_pm_census_cdc_test_beds$smoke, mean_summer_temp = aggregate_pm_census_cdc_test_beds$mean_summer_temp, mean_winter_temp =  aggregate_pm_census_cdc_test_beds$mean_winter_temp, mean_pm25 = aggregate_pm_census_cdc_test_beds$mean_pm25, mean_summer_rm = aggregate_pm_census_cdc_test_beds$mean_summer_rm, mean_winter_rm = aggregate_pm_census_cdc_test_beds$mean_winter_rm)
  #save(confounding, file = 'confounding.Rda')
load('confounding.Rda')
```

## Create smaller datasets from previous datasets, dataclean, merge with PM25 dataset.
```{r}
coastal.new = data.frame(coastal$`FIPS as Text`, coastal$state, coastal$cases, coastal$deaths, coastal$`Country REGION`, coastal$`Coastal Distance`, coastal$`Population 2019 Estimate`, coastal$`Population Density`, coastal$`All Ages in Poverty (%)`, coastal$`Under 18s in Poverty`, coastal$`Median Income`, coastal$`percent adult obesity`, coastal$`diff/total`, coastal$`Politcal alignment 2020 election`, coastal$`median age 2019`, coastal$Humid)
colnames(coastal.new) = c('fips', 'state', 'cases', 'deaths', 'region', 'coastal.distance', 'population2019', 'popdensity', 'poverty', 'under18poverty', 'median_income', 'pct_obesity', 'voter_margin_2020', 'party', 'median_age', 'humidity')

#change NAs in coastal.distance to level 4, and save as factor with reference level 4.
coastal.new$coastal.distance[is.na(coastal.new$coastal.distance)] <- 4
coastal.new$coastal.distance = as.factor(coastal.new$coastal.distance)
coastal.new <- within(coastal.new, coastal.distance <- relevel(coastal.distance, ref = 4))

#change NAs in coastal region to Inland, and save as factor with reference level Inland
coastal.new$region[is.na(coastal.new$region)] <- 'Inland'
coastal.new$region[coastal.new$region == '0'] <- 'Inland'
coastal.new$region[coastal.new$coastal.distance != 1] <- 'Inland'
coastal.new$region = tolower(coastal.new$region)
coastal.new$region = as.factor(coastal.new$region)
coastal.new <- within(coastal.new, region <- relevel(region, ref = 'inland'))

#Merge with confounding dataset
coastal.new = merge(coastal.new, confounding, by = 'fips')

## Create indicator for being a coast (degree 1) 
coastal.new$indicatorcoast = ifelse(coastal.new$coastal.distance == '1', 'Coastal', 'NonCoastal')
coastal.new$indicatorcoast = as.factor(coastal.new$indicatorcoast)
coastal.new <- within(coastal.new, indicatorcoast <- relevel(indicatorcoast, ref = 'NonCoastal'))

summary(coastal.new)
```
\newpage
## Look at correlation of confounders with exposure and outcome - does not yet include party
```{r}
coastal.new$caserate = coastal.new$cases/coastal.new$population2019
coastal.new$deathrate = coastal.new$deaths/coastal.new$population2019
coastal.new$bedrate = coastal.new$beds/coastal.new$population.old

#numeric variables
x = data.frame(log(coastal.new$popdensity), coastal.new$poverty, log(coastal.new$median_income), coastal.new$pct_obesity, coastal.new$voter_margin_2020, coastal.new$median_age, log(coastal.new$median_house_value), coastal.new$owner_occupied, coastal.new$blk_pct, coastal.new$hispanic_pct, coastal.new$white_pct, coastal.new$native_pct, coastal.new$asian_pct, coastal.new$no_grad, coastal.new$date_since, coastal.new$date_since_social, coastal.new$bedrate, coastal.new$smoke, coastal.new$mean_summer_temp, coastal.new$mean_winter_temp, coastal.new$mean_pm25, coastal.new$mean_summer_rm, coastal.new$mean_winter_rm, coastal.new$caserate, coastal.new$deathrate)
cormat = cor(x)

data.frame(corr_caserate = sort(abs(cormat[,(ncol(x)-1)]), decreasing = T))#correlation of confounders with caserate
data.frame(corr_deathrate = sort(abs(cormat[,ncol(x)]), decreasing = T))#correlation of confounders with deatherate

library(polycor)
polycors = rep(NA, ncol(x))
names(polycors) = names(x)
for (i in 1:ncol(x)){
  polycors[i] = polyserial(x[,i], coastal.new$indicatorcoast)
}
data.frame(corr_indicatorcoast = sort(abs(polycors), decreasing = T))

# Party - don't include if voter margin is already included?

x.chosen = x[,c(1,2,3,4,5,6,7,9,11,12,13,14,16,18,19,20)]
names(x.chosen)
cor(x.chosen)
```


\newpage
## Analysis of Coastal vs Noncoastal
```{r}
# Model cases
model.indicator.cases = gee(cases ~ indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"), data = coastal.new, id = as.factor(state))
summary(model.indicator.cases)$coefficients

# Model deaths
model.indicator.deaths = gee(deaths ~  indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.indicator.deaths)$coefficients

############ Repeat above, - humidity #############

# Model cases
model.indicator.cases.nohumidity = gee(cases ~  indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.indicator.cases.nohumidity)$coefficients

# Model deaths
model.indicator.deaths.nohumidity = gee(deaths ~  indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.indicator.deaths.nohumidity)$coefficients
```

\newpage
## Analysis by region
```{r}
model.byregion.cases = gee(cases ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregion.cases)$coefficients

model.byregion.deaths = gee(deaths ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregion.deaths)$coefficients

#### Repeat above, - humidity ###############

model.byregion.cases.nohumidity = gee(cases ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregion.cases.nohumidity)$coefficients

model.byregion.deaths.nohumidity = gee(deaths ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregion.deaths.nohumidity)$coefficients
```
\newpage
## By region, splitting into Urban and Rural
```{r}
coastal.new$area = ifelse(coastal.new$popdensity >= 1500, 'Urban', 'Rural')
summary(as.factor(coastal.new$area))

coastal.new$regionru = paste(as.character(coastal.new$region), coastal.new$area)
coastal.new$regionru[coastal.new$regionru == 'inland Rural'] = 'inland'
coastal.new$regionru[coastal.new$regionru == 'inland Urban'] = 'inland'
coastal.new$regionru = as.factor(coastal.new$regionru)
coastal.new <- within(coastal.new, regionru <- relevel(regionru, ref = 'inland'))
summary(coastal.new$regionru)

model.byregionru.cases = gee(cases ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregionru.cases)$coefficients

model.byregionru.deaths = gee(deaths ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregionru.deaths)$coefficients

model.byregionru.cases.nohumidity = gee(cases ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregionru.cases.nohumidity)$coefficients

model.byregionru.deaths.nohumidity = gee(deaths ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))
summary(model.byregionru.deaths.nohumidity)$coefficients
```
\newpage
## Comparing 1st vs 2nd vs 3rd degree Coastal
```{r}
# Subset coastal counties only
coastal.only = coastal.new[coastal.new$coastal.distance != 4,]
nrow(coastal.only)
nrow(na.omit(coastal.only)) #check nas
coastal.only$coastal.distance = factor(coastal.only$coastal.distance) #drops level 4
summary(coastal.only)

# Model cases
model.initial.cases = gee(cases ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"),  data = coastal.only, id = as.factor(state))
summary(model.initial.cases)$coefficients

# Model deaths
model.initial.deaths = gee(deaths ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25 + mean_summer_rm + mean_winter_rm, family = poisson(link = "log"),  data = coastal.only, id = as.factor(state))
summary(model.initial.deaths)$coefficients

##### Repeat above, - humidity ######
# Model cases
model.initial.cases.nohumidity = gee(cases ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.only, id = as.factor(state))
summary(model.initial.cases.nohumidity)$coefficients

# Model deaths
model.initial.deaths.nohumidity = gee(deaths ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) + mean_pm25, family = poisson(link = "log"),  data = coastal.only, id = as.factor(state))
summary(model.initial.deaths.nohumidity)$coefficients
```


\newpage
## Same Analysis with Our Additional Confounders
```{r}
model.indicator.cases.addconfounders = gee(cases ~  indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

model.indicator.deaths.addconfounders = gee(deaths ~  indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct)
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

model.byregion.cases.addconfounders = gee(cases ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct)
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

model.byregion.deaths.addconfounders = gee(deaths ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

# - humidity
model.indicator.cases.nohumidity.addconfounders = gee(cases ~  indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

model.indicator.deaths.nohumidity.addconfounders = gee(deaths ~  indicatorcoast + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))

model.byregion.cases.nohumidity.addconfounders = gee(cases ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))

model.byregion.deaths.nohumidity.addconfounders = gee(deaths ~  region + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct)
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))

# Analysis by region, rural/urban split
model.byregionru.cases.addconfounders = gee(cases ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct)
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  data = coastal.new, id = as.factor(state))

model.byregionru.deaths.addconfounders = gee(deaths ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

model.byregionru.cases.nohumidity.addconfounders = gee(cases ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct) 
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

model.byregionru.deaths.nohumidity.addconfounders = gee(deaths ~  regionru + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct)
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.new, id = as.factor(state))

# Comparing 1st vs 2nd vs 3rd degree coastal counties
model.initial.cases.addconfounders = gee(cases ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct)
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.only, id = as.factor(state))


model.initial.deaths.addconfounders = gee(deaths ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct)
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              + scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.only, id = as.factor(state))

model.initial.cases.nohumidity.addconfounders = gee(cases ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct)
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.only, id = as.factor(state))

model.initial.deaths.nohumidity.addconfounders = gee(deaths ~  coastal.distance + offset(log(population2019)) + scale(popdensity) + scale(poverty) + scale(log(median_income)) + scale(pct_obesity) + scale(voter_margin_2020) + scale(median_age) + factor(party) 
                              + scale(log(median_house_value)) + scale(owner_occupied) 
                              + scale(blk_pct) + scale(hispanic_pct) 
                              + scale(native_pct) + scale(asian_pct)
                              + scale(date_since_social) + scale(date_since) 
                              + scale(beds/population.old) + scale(smoke) 
                              + scale(mean_pm25) 
                              #+ scale(mean_summer_rm) + scale(mean_winter_rm) 
                              + scale(mean_summer_temp) + scale(mean_winter_temp)
                              + scale(no_grad), family = poisson(link = "log"),  
                              data = coastal.only, id = as.factor(state))
```

\newpage
## Print tables
```{r eval = F}
# Run each line individually not all at once
tab_model(model.indicator.cases, model.indicator.cases.nohumidity, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.indicator.deaths, model.indicator.deaths.nohumidity, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))

tab_model(model.byregion.cases, model.byregion.cases.nohumidity, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.byregion.deaths, model.byregion.deaths.nohumidity, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))

tab_model(model.byregionru.cases, model.byregionru.cases.nohumidity, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.byregionru.deaths, model.byregionru.deaths.nohumidity, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))

tab_model(model.initial.cases, model.initial.cases.nohumidity, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.initial.deaths, model.initial.deaths.nohumidity, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))

## Add additional confounders
tab_model(model.indicator.cases.addconfounders, model.indicator.cases.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.indicator.deaths.addconfounders, model.indicator.deaths.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))

tab_model(model.byregion.cases.addconfounders, model.byregion.cases.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.byregion.deaths.addconfounders, model.byregion.deaths.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))

tab_model(model.byregionru.cases.addconfounders, model.byregionru.cases.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.byregionru.deaths.addconfounders, model.byregionru.deaths.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))

tab_model(model.initial.cases.addconfounders, model.initial.cases.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Cases (Humidity +)", "Cases (Humidity -)"))
tab_model(model.initial.deaths.addconfounders, model.initial.deaths.nohumidity.addconfounders, robust = T, digits = 3, dv.labels = c("Deaths (Humidity +)", "Deaths (Humidity -)"))
```

















